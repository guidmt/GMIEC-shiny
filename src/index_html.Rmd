---
title: "VIS-GMIEC output"
author: GMIEC
output: 
  html_document:
    theme: journal
params: 
  input_for_gmiec_report: "test"
  patient: "patient"
---



### Welcome! This is the report of your analysis.

Features:
- Visualization of groups of patients by scores (SAD, SAM, SAD drugs) 
- principal component analysis results
- Visualization of the single patient results

# Navigation bar {.tabset}

```{r include= FALSE}
library(heatmaply)
library(ggplot2)
library(formattable)
#input_for_gmiec<-read.delim(file="C:/Users/guida/Desktop/work/GMIEC_shiny/Analysis_GMIEC_main_results.txt")
##clean the input for analysis
colToselect<-paste(c("gene","drug","sad","score"),collapse="|")
input_for_gmiec<-params$input_for_gmiec_report
input_for_gmiec<-cbind(rownames(input_for_gmiec),input_for_gmiec)
colnames(input_for_gmiec)[2:ncol(input_for_gmiec)]<-input_for_gmiec[1,2:ncol(input_for_gmiec)]

idx<-grep(input_for_gmiec[,1],pattern=colToselect)
input_for_gmiec<-input_for_gmiec[idx,]

#this is for sad score
idx_sad<-grep(input_for_gmiec[,1],pattern="sad")

matrix_sad<-input_for_gmiec[idx_sad,]
matrix_sad[is.na(matrix_sad)]<-0

matrix_sad2<-apply(matrix_sad, 2, as.numeric)
rownames(matrix_sad2)<-paste("Module",1:nrow(matrix_sad2))
```

## Heatmap of the combined scores (SAD) 

The following heatmap represent the SAD scores of the modules in each patient. The x-axis are the modules, the y-axis the patients. The values in each cell are the SAD scores. The SAD score is computed by the combination of score alteration module (delta A) and score alteration drugs (delta D). Click on the cell to see major details about the genes/drugs inside and modules.

- blue colors highlight modules with group of genes that share few genomic alterations and targeted by drugs.
- red colors highlight modules with group of genes that share  genomic alterations and targeted by few drugs.

```{r message=F, echo=FALSE}
heatmaply(t(matrix_sad2[,-1]),col=RdYlBu,Colv=FALSE)
```

```{r message=F, echo=FALSE}
#this is for sad score
idx_sam<-grep(input_for_gmiec[,1],pattern="score_alteration_module")

matrix_sam<-t(input_for_gmiec[idx_sam,-1])
matrix_sam[is.na(matrix_sam)]<-0

matrix_sam2<-apply(matrix_sam, 2, as.numeric)
rownames(matrix_sam2)<-rownames(matrix_sam)
colnames(matrix_sam2)<-paste("Module",1:ncol(matrix_sam2))
```

## Heatmap of the SAM scores (delta A)

The following heatmap represent the SAM scores of the modules in each patient. The x-axis are the modules, the y-axis the patients. The values in each cell are the SAM scores. Click on the cell to see major details about the genes/drugs inside and modules.

```{r message=F, echo=FALSE}
heatmaply(matrix_sam2,colors=BrBG,Colv=FALSE)
```

## Heatmap of the scores SAD (delta D)
The following heatmap represent the SAD score of the modules in each patient. The x-axis are the modules, the y-axis the patients. The values in each cell are the SAD scores. Click on the cell to see major details about the genes/drugs inside and modules.

```{r message=F, echo=FALSE}
#this is for sad score
idx_sadrugs<-grep(input_for_gmiec[,1],pattern="score_alteration_drugs")

matrix_sadrugs<-t(input_for_gmiec[idx_sadrugs,-1])
matrix_sadrugs[is.na(matrix_sadrugs)]<-0

matrix_sadrugs2<-apply(matrix_sadrugs, 2, as.numeric)
colnames(matrix_sadrugs2)<-paste("Module",1:ncol(matrix_sadrugs))
rownames(matrix_sadrugs2)<-rownames(matrix_sadrugs)
```

```{r message=F, echo=FALSE}
heatmaply(matrix_sadrugs2,colors=PRGn,Colv=FALSE)
```

# Navigation bar principal component analysis {.tabset}

## PCA - matrix SAD scores
Results of the principal component analysis of the patients and pca-biplot variable-individuals of SAD scores.
```{r message=F, echo=FALSE}
library(psych)
library("factoextra")

res.pc1<-prcomp(matrix_sad2[,-1])

fviz_pca_ind(res.pc1,col.ind="cos2")
fviz_pca_biplot(res.pc1,repel=TRUE)
```

## PCA - matrix SAM scores
Results of the principal component analysis of the patients and pca-biplot variable-individuals of SAM scores.
```{r message=F, echo=FALSE}
library(psych)
library("factoextra")

res.pc2<-prcomp(matrix_sam2)

fviz_pca_ind(res.pc2,col.ind="cos2")
fviz_pca_biplot(res.pc2,repel=TRUE)
```

## PCA - matrix SAD drugs scores
Results of the principal component analysis of the patients and pca-biplot variable-individuals of SAD drugs scores.
```{r message=F, echo=FALSE}
library(psych)
library("factoextra")

res.pc3<-prcomp(matrix_sadrugs2)

fviz_pca_ind(res.pc3,col.ind="cos2")
fviz_pca_biplot(res.pc3,repel=TRUE)
```

# Visualization of the single patient results {.tabset .tabset-fade .tabset-dropdown}

```{r message=F, echo=FALSE, results='asis',include=TRUE}
for (i in colnames(matrix_sad[,-1])){
  
  string<-paste(paste("[",paste(i," |",sep=""),sep=""),"]",sep="")
  path<-unlist(strsplit(getwd(),split="/GMIEC_shiny/src"))
  link_to_string<-paste(paste("(",paste(paste(paste(path,"GMIEC_shiny/VIS-GMIEC","output_vis/",sep="/"),paste("report.",i,sep=""),sep=""),".html",sep=""),sep=""),")",sep="")
  cat(paste(string,link_to_string,sep=""))
  cat("\n")

}
```